import java.io.File;
import java.util.ArrayList;
import java.util.Scanner;
import java.io.IOException;
import java.io.FileWriter;
public class GUI {
    static Scanner input = new Scanner(System.in);

    public static void main(String[] args) {
        mainMenu();
    }

    // MAIN MENU
    public static void mainMenu() {
        boolean finished = false;

        while (!finished) {
            System.out.println("=== Basic Text Analysis Tool ===");
            System.out.println("Select Number for Function.");
            System.out.println("1. Select Topic");
            System.out.println("2. Add Topic");
            System.out.println("3. Add Article");
            System.out.println("4. Exit");
            System.out.print("Enter Choice: ");

            int num = input.nextInt();

            switch (num) {
                case 1 -> selectTopicMenu();
                case 2 -> addTopicMenu();
                case 3 -> addArticleMenu();
                case 4 -> {
                    System.out.println("Basic Text Analysis Tool Closed.");
                    finished = true;
                }
                default -> System.out.println("Invalid input. Please enter a number 1-4.");
            }
        }
    }

    // SUBMENUS
    public static void selectTopicMenu() {
        System.out.println("Select Topic:");
        File folder = new File("data");
        File[] files = folder.listFiles();

        if(files != null) {
            for (File f : files) {
                System.out.println(f.getName());
            }
        } else {
            System.out.println("No topics available.");
            return;
        }

        input.nextLine();
        System.out.print("Enter Choice: ");
        String topic = input.nextLine();

        for (File f : files) {
            if (f.getName().equals(topic)) {
                System.out.println("Basic Text Analysis for " + topic);
                basicAnalysis(topic);
            }
        }
    }

    public static void addTopicMenu() {
        input.nextLine();
        System.out.print("Enter New Topic Name: ");
        String topicName = input.nextLine().trim();

        File newTopicFolder = new File("data/" + topicName);

        if (newTopicFolder.exists()) {
            System.out.println("Topic " + topicName + " already exists.");
        } else {
            if (newTopicFolder.mkdirs()) {
                System.out.println("Topic Created: " + topicName);
                System.out.println("Add articles using option 3.");
            } else {
                System.out.println("Topic Creation Failed.");
            }
        }
    }

    public static void addArticleMenu() {
        File dataFolder = new File("data");
        File[] topics = dataFolder.listFiles(File::isDirectory);

        if (topics == null || topics.length == 0) {
           System.out.println("No topics available. Create a topic with option 2.");
           return;
        }

        System.out.println("Chose a topic to add an article to: ");
        File folder = new File("data");
        File[] files = folder.listFiles();
        if(files != null) {
            for (File f : files) {
                System.out.println(f.getName());
            }
        }

        System.out.print("Enter Choice: ");
        String topic = input.nextLine();

        input.nextLine(); // clear buffer
        System.out.print("Enter article text: ");
        String articleText = input.nextLine();

        // Count existing articles
        File topicFolder = new File("data/" + topic);
        int articleNum = topicFolder.listFiles((d, name) -> name.endsWith(".txt")).length + 1;

        File newArticle = new File(topicFolder, topic + "Article" + articleNum + ".txt");

        try (FileWriter writer = new FileWriter(newArticle)) {
            writer.write(articleText);
            System.out.println("Article saved as: " + newArticle.getName());
        } catch (IOException e) {
            System.out.println("Error writing article: " + e.getMessage());
        }

        mainMenu();
    }

    public static void basicAnalysis(String topic) {
        FileLoader file1 = new FileLoader("data/"+topic+"/"+topic+"Article1.txt");
        FileLoader file2 = new FileLoader("data/"+topic+"/"+topic+"Article2.txt");
        FileLoader file3 = new FileLoader("data/"+topic+"/"+topic+"Article3.txt");

        ArticleList article10 = new ArticleList(file1.loadFile());
        ArticleList article20 = new ArticleList(file2.loadFile());
        ArticleList article30 = new ArticleList(file3.loadFile());

        System.out.println();
        System.out.println("File 1 Total Words: " + article10.getWords().size());
        System.out.println("File 2 Total Words: " + article20.getWords().size());
        System.out.println("File 3 Total Words: " + article30.getWords().size());

        StopWords stop = new StopWords("files/stopwords.txt");

        ArrayList<String> file1R = new ArrayList<>(article10.removeStopWords(stop));
        ArrayList<String> file2R = new ArrayList<>(article20.removeStopWords(stop));
        ArrayList<String> file3R = new ArrayList<>(article30.removeStopWords(stop));

        ArticleList article1 = new ArticleList(file1R);
        ArticleList article2 = new ArticleList(file2R);
        ArticleList article3 = new ArticleList(file3R);

        System.out.println();
        System.out.println("File 1 Total Words After Removing Stop Words: " + file1R.size());
        System.out.println("File 2 Total Words After Removing Stop Words: " + file2R.size());
        System.out.println("File 3 Total Words After Removing Stop Words: " + file3R.size());

        System.out.println();
        System.out.println("File 1 Total Unique Words: " + article1.uniqueWords().size());
        System.out.println("File 2 Total Unique Words: " + article2.uniqueWords().size());
        System.out.println("File 3 Total Unique Words: " + article3.uniqueWords().size());

        System.out.println();
        System.out.println("File 1 Word Frequency Ranking:");
        article1.countWordFrequency();

        System.out.println();
        System.out.println("File 2 Word Frequency Ranking:");
        article2.countWordFrequency();

        System.out.println();
        System.out.println("File 3 Word Frequency Ranking:");
        article3.countWordFrequency();

        System.out.println();
        article1.richestVocab(article1, article2, article3);

        System.out.println();
        article1.top5Words();
        System.out.println();
        article2.top5Words();
        System.out.println();
        article3.top5Words();

        System.out.println();
        article1.attitude();
        System.out.println();
        article2.attitude();
        System.out.println();
        article3.attitude();
    }
}
